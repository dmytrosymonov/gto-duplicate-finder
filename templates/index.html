<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTO Hotel Duplicate Finder</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Поиск дубликатов отелей GTO.UA</h1>
    </header>

    <section class="config">
      <h2>Настройки</h2>
      <div class="row">
        <label for="apikey">API Key</label>
        <input type="password" id="apikey" placeholder="Введите API key или используйте GTO_API_KEY">
        {% if api_key_set %}
        <span class="hint">(ключ задан)</span>
        {% endif %}
      </div>
      <div class="row">
        <label for="rps">Max requests/sec</label>
        <input type="number" id="rps" value="5" min="1" max="50" step="0.5">
      </div>
      <div class="row">
        <button id="saveApikey" type="button">Сохранить API key</button>
      </div>
    </section>

    <section class="geo">
      <h2>География</h2>
      <div class="row">
        <label for="country">Страна</label>
        <select id="country" {% if not api_key_set %}disabled{% endif %}>
          <option value="">-- Выберите страну --</option>
        </select>
      </div>
      <div class="row">
        <label for="citySearch">Города для поиска (можно выбрать несколько)</label>
        <div class="city-picker">
          <input type="text" id="citySearch" placeholder="Поиск города..." disabled>
          <div class="city-list" id="cityList"></div>
          <div class="selected-cities" id="selectedCities"></div>
        </div>
      </div>
      <div class="row">
        <button id="startScan" type="button" disabled>Start scan</button>
      </div>
    </section>

    <section class="progress" id="progressSection" hidden>
      <h2>Прогресс</h2>
      <div class="stats-grid">
        <div class="stat">
          <span class="stat-label">Отелей загружено</span>
          <span class="stat-value" id="hotelsLoaded">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Кандидатов обработано</span>
          <span class="stat-value" id="comparisonsDone">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Флагов найдено</span>
          <span class="stat-value" id="flagsFound">0</span>
        </div>
      </div>
      <div class="api-stats">
        <span>Лимит rps: <strong id="rpsDisplay">5</strong></span>
        <span>Запросов к API: <strong id="apiRequests">0</strong></span>
        <span>Среднее время ответа: <strong id="avgResponse">0</strong> мс</span>
        <span>Пиковое время: <strong id="peakResponse">0</strong> мс</span>
      </div>
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-pct" id="progressPct">0%</div>
    </section>

    <section class="history" id="historySection">
      <h2>История сканов</h2>
      <p class="hint">Доступна в течение 2 часов после завершения. Требует авторизацию по API key.</p>
      <button id="loadHistory" type="button">Загрузить историю</button>
      <div class="history-list" id="historyList"></div>
    </section>

    <section class="results" id="resultsSection">
      <h2>Результаты</h2>
      <div class="filters">
        <label>
          <select id="filterType">
            <option value="all">Все</option>
            <option value="auto">auto</option>
            <option value="review">review</option>
          </select>
        </label>
        <label>
          Сортировка:
          <select id="sortBy">
            <option value="reason">Причина флага</option>
            <option value="score">По скорингу</option>
          </select>
        </label>
        <button id="exportExcel" type="button" disabled>Экспорт в Excel</button>
      </div>
      <div class="table-wrapper">
        <table id="resultsTable">
          <thead>
            <tr>
              <th data-sort="hotel_name">Название отеля</th>
              <th data-sort="id1">ID 1</th>
              <th data-sort="id2">ID 2</th>
              <th data-sort="address">Адрес</th>
              <th data-sort="score">Общий скоринг</th>
              <th data-sort="reason">Причина флага</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script src="/static/app.js?v=5"></script>
</body>
</html>
